# 需求文档：邮件发送会议纪要功能

## 引言

本需求文档描述了将会议纪要页面的"导出 PDF"按钮替换为"发送邮件"功能的详细需求。该功能允许用户在会议纪要生成完成后，通过邮件将纪要内容发送到指定的邮箱地址。

### 功能概述
- 移除现有的"导出 PDF"按钮
- 添加"发送邮件"按钮
- 实现邮箱地址输入对话框
- 实现后端邮件发送服务
- 支持发送中文和英文双语会议纪要

### 技术背景
- 前端：React + Lucide Icons
- 后端：Node.js + Express
- 邮件服务：需要集成 Nodemailer 库
- 现有API结构：RESTful API，已有 `/api/minutes/:fileId` 接口

---

## 需求

### 需求 1：移除PDF导出按钮并添加邮件发送按钮

**用户故事：** 作为一名会议参与者，我希望在会议纪要生成完成后看到"发送邮件"按钮而不是"导出 PDF"按钮，以便我可以快速将纪要分享给相关人员。

#### 验收标准

1. WHEN 用户查看会议纪要完成页面 THEN 系统 SHALL 显示"发送邮件"按钮而不是"导出 PDF"按钮
2. WHEN 用户将鼠标悬停在"发送邮件"按钮上 THEN 系统 SHALL 显示悬停效果（颜色变化、阴影增强）
3. IF 按钮被点击 THEN 系统 SHALL 弹出邮箱地址输入对话框
4. WHEN 按钮渲染时 THEN 系统 SHALL 使用邮件图标（Mail icon）替代下载图标（Download icon）

---

### 需求 2：实现邮箱地址输入对话框

**用户故事：** 作为一名用户，我希望点击"发送邮件"按钮后能够输入收件人邮箱地址，以便将会议纪要发送给指定的人员。

#### 验收标准

1. WHEN 用户点击"发送邮件"按钮 THEN 系统 SHALL 显示模态对话框
2. WHEN 对话框显示时 THEN 系统 SHALL 包含以下元素：
   - 对话框标题："发送会议纪要到邮箱"
   - 邮箱地址输入框（带占位符提示）
   - "取消"按钮
   - "发送"按钮
3. WHEN 用户在输入框中输入内容 THEN 系统 SHALL 实时更新输入状态
4. WHEN 用户点击对话框外部区域 THEN 系统 SHALL 关闭对话框
5. WHEN 用户点击"取消"按钮 THEN 系统 SHALL 关闭对话框并清空输入内容
6. IF 输入框为空 AND 用户点击"发送"按钮 THEN 系统 SHALL 显示错误提示"请输入邮箱地址"
7. IF 输入的邮箱格式无效 AND 用户点击"发送"按钮 THEN 系统 SHALL 显示错误提示"请输入有效的邮箱地址"
8. WHEN 对话框打开时 THEN 系统 SHALL 自动聚焦到邮箱输入框

---

### 需求 3：实现邮箱地址验证

**用户故事：** 作为一名用户，我希望系统能够验证我输入的邮箱地址格式是否正确，以便避免发送到无效的邮箱地址。

#### 验收标准

1. WHEN 用户输入邮箱地址 THEN 系统 SHALL 使用正则表达式验证邮箱格式
2. IF 邮箱格式符合标准（包含@符号、域名等） THEN 系统 SHALL 允许发送
3. IF 邮箱格式不符合标准 THEN 系统 SHALL 显示错误提示并阻止发送
4. WHEN 验证失败时 THEN 系统 SHALL 在输入框下方显示红色错误文本
5. WHEN 用户修正输入后 THEN 系统 SHALL 清除错误提示

---

### 需求 4：实现前端邮件发送请求

**用户故事：** 作为一名用户，我希望点击"发送"按钮后系统能够将会议纪要发送到我指定的邮箱，以便我可以在邮箱中查看和保存纪要。

#### 验收标准

1. WHEN 用户点击"发送"按钮 AND 邮箱地址有效 THEN 系统 SHALL 向后端API发送POST请求
2. WHEN 发送请求时 THEN 系统 SHALL 包含以下数据：
   - fileId（当前会议纪要的文件ID）
   - recipientEmail（收件人邮箱地址）
3. WHEN 请求发送中 THEN 系统 SHALL 显示加载状态（按钮禁用、显示"发送中..."文本）
4. IF 请求成功 THEN 系统 SHALL 显示成功提示"邮件发送成功！"并关闭对话框
5. IF 请求失败 THEN 系统 SHALL 显示错误提示"邮件发送失败，请稍后重试"并保持对话框打开
6. WHEN 发送成功后 THEN 系统 SHALL 在3秒后自动隐藏成功提示

---

### 需求 5：实现后端邮件发送API

**用户故事：** 作为系统管理员，我希望后端能够接收前端的邮件发送请求并通过SMTP服务发送邮件，以便用户能够收到会议纪要。

#### 验收标准

1. WHEN 系统启动时 THEN 系统 SHALL 创建新的API端点 `POST /api/send-email`
2. WHEN 接收到邮件发送请求 THEN 系统 SHALL 验证请求参数（fileId、recipientEmail）
3. IF 参数缺失或无效 THEN 系统 SHALL 返回400错误和错误信息
4. WHEN 参数有效时 THEN 系统 SHALL 从内存中获取对应的会议纪要数据
5. IF 会议纪要数据不存在 THEN 系统 SHALL 返回404错误"会议纪要未找到"
6. WHEN 会议纪要数据存在时 THEN 系统 SHALL 调用邮件发送服务
7. IF 邮件发送成功 THEN 系统 SHALL 返回200状态码和成功消息
8. IF 邮件发送失败 THEN 系统 SHALL 返回500错误和失败原因

---

### 需求 6：集成Nodemailer邮件服务

**用户故事：** 作为系统管理员，我希望系统能够使用Nodemailer库发送邮件，以便实现可靠的邮件发送功能。

#### 验收标准

1. WHEN 系统初始化时 THEN 系统 SHALL 安装并导入nodemailer依赖包
2. WHEN 系统启动时 THEN 系统 SHALL 从环境变量读取SMTP配置：
   - SMTP_HOST（SMTP服务器地址）
   - SMTP_PORT（SMTP端口）
   - SMTP_USER（发件人邮箱）
   - SMTP_PASS（邮箱密码或授权码）
3. WHEN 配置读取完成后 THEN 系统 SHALL 创建nodemailer传输器（transporter）
4. IF SMTP配置缺失 THEN 系统 SHALL 记录警告日志并使用默认配置或禁用邮件功能
5. WHEN 发送邮件时 THEN 系统 SHALL 使用配置的传输器发送邮件

---

### 需求 7：设计邮件内容格式

**用户故事：** 作为邮件接收者，我希望收到的邮件内容格式清晰、美观，包含完整的会议纪要信息，以便我可以轻松阅读和理解。

#### 验收标准

1. WHEN 系统生成邮件内容时 THEN 系统 SHALL 使用HTML格式
2. WHEN 邮件内容生成时 THEN 系统 SHALL 包含以下部分：
   - 邮件主题："会议纪要 - [会议标题]"
   - 邮件头部：EchoFlow品牌标识和问候语
   - 中文会议纪要部分（包含所有字段）
   - 英文会议纪要部分（包含所有字段）
   - 邮件尾部：系统信息和时间戳
3. WHEN 渲染会议纪要时 THEN 系统 SHALL 包含以下字段：
   - 会议标题
   - 会议日期
   - 参会人员
   - 会议摘要
   - 关键讨论点
   - 决策事项
   - 行动项（包含任务、负责人、截止日期）
   - 风险和问题（如果有）
4. WHEN 格式化内容时 THEN 系统 SHALL 使用适当的HTML标签和CSS样式
5. WHEN 邮件发送时 THEN 系统 SHALL 同时提供纯文本版本作为备用

---

### 需求 8：添加环境变量配置

**用户故事：** 作为系统管理员，我希望能够通过环境变量配置SMTP邮件服务，以便在不同环境中灵活部署。

#### 验收标准

1. WHEN 系统部署时 THEN 系统 SHALL 在.env.example文件中添加SMTP配置示例
2. WHEN 配置文件更新时 THEN 系统 SHALL 包含以下配置项：
   - SMTP_HOST（默认值：smtp.gmail.com）
   - SMTP_PORT（默认值：587）
   - SMTP_SECURE（默认值：false）
   - SMTP_USER（发件人邮箱）
   - SMTP_PASS（邮箱密码或授权码）
   - SMTP_FROM_NAME（发件人名称，默认：EchoFlow）
3. WHEN 配置文件更新时 THEN 系统 SHALL 添加配置说明注释
4. WHEN 系统读取配置时 THEN 系统 SHALL 使用dotenv库加载环境变量

---

### 需求 9：实现错误处理和日志记录

**用户故事：** 作为系统管理员，我希望系统能够记录邮件发送的成功和失败情况，以便我可以监控和排查问题。

#### 验收标准

1. WHEN 邮件发送成功时 THEN 系统 SHALL 记录日志：收件人邮箱、会议ID、发送时间
2. WHEN 邮件发送失败时 THEN 系统 SHALL 记录错误日志：错误原因、收件人邮箱、会议ID
3. IF SMTP连接失败 THEN 系统 SHALL 捕获异常并返回友好的错误信息
4. IF 邮件内容生成失败 THEN 系统 SHALL 捕获异常并返回错误信息
5. WHEN 发生错误时 THEN 系统 SHALL 不暴露敏感信息（如SMTP密码）给前端

---

### 需求 10：优化用户体验

**用户故事：** 作为一名用户，我希望邮件发送过程流畅、反馈及时，以便我能够清楚地了解操作状态。

#### 验收标准

1. WHEN 用户点击"发送"按钮后 THEN 系统 SHALL 在1秒内显示加载状态
2. WHEN 邮件发送中 THEN 系统 SHALL 禁用"发送"按钮防止重复提交
3. WHEN 邮件发送完成后 THEN 系统 SHALL 在3秒内显示结果反馈
4. IF 发送成功 THEN 系统 SHALL 显示绿色成功提示和勾选图标
5. IF 发送失败 THEN 系统 SHALL 显示红色错误提示和错误图标
6. WHEN 对话框打开时 THEN 系统 SHALL 使用平滑的淡入动画
7. WHEN 对话框关闭时 THEN 系统 SHALL 使用平滑的淡出动画
8. WHEN 用户在移动设备上使用时 THEN 系统 SHALL 确保对话框和按钮适配小屏幕

---

## 技术约束

1. **邮件服务选择**：使用Nodemailer库，支持多种SMTP服务（Gmail、Outlook、企业邮箱等）
2. **邮件格式**：使用HTML格式，同时提供纯文本备用版本
3. **安全性**：SMTP密码通过环境变量配置，不硬编码在代码中
4. **性能**：邮件发送采用异步处理，不阻塞主线程
5. **兼容性**：前端对话框需兼容主流浏览器（Chrome、Firefox、Safari、Edge）
6. **错误处理**：所有网络请求和邮件发送操作都需要try-catch包裹
7. **日志记录**：使用console.log记录关键操作，便于调试和监控

---

## 非功能性需求

1. **可用性**：邮件发送成功率应达到95%以上（排除用户输入错误）
2. **响应时间**：邮件发送请求应在10秒内完成（包括网络延迟）
3. **可维护性**：代码应遵循现有项目的编码规范，注释清晰
4. **可扩展性**：邮件模板应易于修改和扩展，支持未来添加附件功能
5. **安全性**：防止邮件地址注入攻击，验证所有用户输入

---

## 实现优先级

1. **高优先级**（核心功能）：
   - 需求1：移除PDF按钮并添加邮件按钮
   - 需求2：实现邮箱输入对话框
   - 需求5：实现后端邮件发送API
   - 需求6：集成Nodemailer服务
   - 需求7：设计邮件内容格式

2. **中优先级**（重要功能）：
   - 需求3：邮箱地址验证
   - 需求4：前端发送请求
   - 需求8：环境变量配置

3. **低优先级**（优化功能）：
   - 需求9：错误处理和日志
   - 需求10：用户体验优化

---

## 成功标准

1. 用户能够在会议纪要完成页面看到"发送邮件"按钮
2. 用户能够输入邮箱地址并成功发送会议纪要
3. 收件人能够在邮箱中收到格式良好的会议纪要邮件
4. 系统能够处理各种错误情况并给出友好提示
5. 所有功能在主流浏览器中正常工作
6. 代码通过构建测试，无语法错误

---

## 风险和依赖

1. **SMTP服务配置**：需要用户提供有效的SMTP服务器配置
2. **邮件送达率**：可能受到收件人邮箱的垃圾邮件过滤影响
3. **网络依赖**：邮件发送依赖网络连接，需要处理网络超时情况
4. **第三方库**：依赖Nodemailer库的稳定性和兼容性
5. **环境变量**：需要在部署时正确配置SMTP相关环境变量

---

**文档版本**：v1.0  
**创建日期**：2026-02-18  
**最后更新**：2026-02-18
